<!DOCTYPE html>
<html>
<head>
<title>HTML5 Dashboard</title>
<script type="text/javascript" src="lib/multigraph/build/multigraph.js"></script>
<script type="text/javascript">
  var $ = window.multigraph.jQuery;
  var Multigraph = window.multigraph.core.Multigraph;

  var buttonState = {}

  var insertGraph = function(id,mugl) {
    var html = (''
      + '<div id="'+id+'graph">'
      +   '<div class="multigraph-holder">'
      +     '<div id="'+id+'-multigraph" style="width: 600px; height: 120px;"></div>'
      +   '</div>'
      + '<div class="graph-spacer"></div>'
      + '</div>'
      );

    $('#dashboard-div').append(html);

    Multigraph.createGraph({'div': id+'-multigraph', 'mugl' : mugl});
  };

  var removeGraph = function(id) {
    $('#'+id+'graph').remove();
  }

  var makeButtonHandler = function(id,mugl) {
      return function() {
        buttonState[id] = !buttonState[id];
        if (buttonState[id]) {
          insertGraph(id,mugl);
        } else {
          removeGraph(id);
        }
      }
  };
  
  $(document).ready(function() {

    $.ajax({"url"      : "config/dashboard.xml",
            "dataType" : "text",
            "success"  : function (data) {
              var configxml = window.multigraph.parser.jquery.stringToJQueryXMLObj(data);
              configxml.find("graph").each(function() {
                 var id = $(this).attr('id');
                 var initiallyopen = ( $(this).attr('initiallyopen') === "true" );
                 var mugl = 'config/' + $(this).find('mugl').attr('url')

                 var html = '<input id="'+id+'box"  type="checkbox"';
                 buttonState[id] = initiallyopen;
                 if (buttonState[id]) {
                   html += ' checked';
                 }
                 html += '> ' + id + '&nbsp;&nbsp;&nbsp;';
                 $('#buttons').append(html);
                 $('#'+id+'box').change( makeButtonHandler(id,mugl) );
                 if (buttonState[id]) {
                   insertGraph(id,mugl);
                 }
           
           
              });
            }});



  });

</script>
<style type="text/css">
#dashboard-div {
  background: #333333;
  width: 620px;
  padding: 10px;
  border-radius:25px;
  -moz-border-radius:25px; /* Firefox 3.6 and earlier */
}
.multigraph-holder {
  padding: 10px;
  background: #ffffff;
  border-radius:25px;
  -moz-border-radius:25px; /* Firefox 3.6 and earlier */
}
.graph-spacer {
  height: 10px;
}
hr {
  width: 600px;
}
</style>
</head>
<body>

<center>
<div id="dashboard-div"></div>
<hr>
<div id="buttons"></div>
</center>

</body>
</html>
